import{y as b,m as j,r as E,j as e}from"./index-DYCdECr2.js";import{H as P,F as v}from"./Footer-5CF68671.js";import{B as N}from"./BlogPostForm-DyVOBuRl.js";import{s}from"./client-opfxi3BE.js";import"./index-DOA-4b-m.js";import"./phone-DAWZ9XqU.js";import"./RichTextEditor-SEif6zb0.js";import"./label-D6la_Z2I.js";import"./quote-CL5U8GGT.js";import"./link-JZZbcmPv.js";import"./minus-qXHcO3_K.js";import"./input-BlRor6HD.js";import"./textarea-CrPgbkNX.js";import"./tabs-C7V-UyVv.js";const $=()=>{const x=b(),{toast:l}=j(),[f,m]=E.useState(!1),u=async(h,r)=>{m(!0);try{const{category_name:o,...w}=h,{data:p,error:a}=await s.from("categories").select("id").eq("name",o).single();if(a&&a.code!=="PGRST116")throw a;let i;if(p)i=p.id;else{const{data:t,error:g}=await s.from("categories").insert({name:o}).select("id").single();if(g)throw g;i=t.id}const y={...w,category_id:i},{data:n,error:d}=await s.from("posts").insert([y]).select().single();if(d)throw d;if(!n)throw new Error("Failed to create post.");const c=[];for(const t in r)c.push({post_id:n.id,language:t,title:r[t].title,excerpt:r[t].excerpt,content:r[t].content,next_steps:r[t].next_steps});if(c.length>0){const{error:t}=await s.from("post_translations").insert(c);if(t)throw t}l({title:"Post created!",description:"Your new blog post has been successfully created."}),x(`/blog/${n.id}`)}catch(o){console.error("Error creating post:",o),l({title:"Error",description:"There was an error creating the post. Please try again.",variant:"destructive"})}finally{m(!1)}};return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(P,{}),e.jsx("main",{className:"flex-grow bg-muted/50 pt-20",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-heading font-bold text-primary mb-8",children:"Create New Post"}),e.jsx(N,{onSubmit:u,isSubmitting:f})]})})}),e.jsx(v,{})]})};export{$ as default};
