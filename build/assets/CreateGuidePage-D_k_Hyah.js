import{y as j,m as b,r as E,j as t}from"./index-DYCdECr2.js";import{H as S,F as v}from"./Footer-5CF68671.js";import{G}from"./GuidePostForm-3k0aYeKf.js";import{s as a}from"./client-opfxi3BE.js";import"./index-DOA-4b-m.js";import"./phone-DAWZ9XqU.js";import"./RichTextEditor-SEif6zb0.js";import"./label-D6la_Z2I.js";import"./quote-CL5U8GGT.js";import"./link-JZZbcmPv.js";import"./minus-qXHcO3_K.js";import"./input-BlRor6HD.js";import"./textarea-CrPgbkNX.js";import"./tabs-C7V-UyVv.js";const $=()=>{const p=j(),{toast:d}=b(),[f,m]=E.useState(!1),x=async(h,r)=>{m(!0);try{const{category_name:i,...w}=h,{data:l,error:o}=await a.from("categories").select("id").eq("name",i).single();if(o&&o.code!=="PGRST116")throw o;let s;if(l)s=l.id;else{const{data:e,error:u}=await a.from("categories").insert({name:i}).select("id").single();if(u)throw u;s=e.id}const y={...w,category_id:s,last_updated:new Date().toISOString()},{data:n,error:g}=await a.from("guides").insert([y]).select().single();if(g)throw g;if(!n)throw new Error("Failed to create guide.");const c=[];for(const e in r)c.push({guide_id:n.id,language:e,title:r[e].title,description:r[e].description,content:r[e].content,next_steps:r[e].next_steps});if(c.length>0){const{error:e}=await a.from("guide_translations").insert(c);if(e)throw e}d({title:"Guide created!",description:"Your new patient guide has been successfully created."}),p(`/guides/${n.id}`)}catch(i){console.error("Error creating guide:",i),d({title:"Error",description:"There was an error creating the guide. Please try again.",variant:"destructive"})}finally{m(!1)}};return t.jsxs("div",{className:"min-h-screen flex flex-col",children:[t.jsx(S,{}),t.jsx("main",{className:"flex-grow bg-muted/50 pt-20",children:t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsxs("div",{className:"max-w-2xl mx-auto",children:[t.jsx("h1",{className:"text-3xl font-heading font-bold text-primary mb-8",children:"Create New Patient Guide"}),t.jsx(G,{onSubmit:x,isSubmitting:f})]})})}),t.jsx(v,{})]})};export{$ as default};
