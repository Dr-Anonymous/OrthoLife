import{c as Z,r as o,j as e,H as _,B as x,m as G,R as K}from"./index-DYCdECr2.js";import{H as Q,F as X}from"./Footer-5CF68671.js";import{P as ee,a as se,F as te}from"./FloatingCart-POT8qY6j.js";import{C as D,a as F,b as R,c as P,e as H,d as ae}from"./card-B7__9nPQ.js";import{C as re}from"./calendar-CWHqpNrr.js";import{s as E}from"./client-opfxi3BE.js";import{C as z}from"./clock-9TRYkq0J.js";import{I as ie}from"./input-BlRor6HD.js";import{B as oe}from"./badge-zPQ83eSx.js";import{M as ne}from"./minus-qXHcO3_K.js";import{C as le}from"./calendar-B3ZTj5yV.js";import"./index-DOA-4b-m.js";import"./phone-DAWZ9XqU.js";import"./label-D6la_Z2I.js";import"./textarea-CrPgbkNX.js";import"./user-B71ZlHy8.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=Z("TestTubes",[["path",{d:"M9 2v17.5A2.5 2.5 0 0 1 6.5 22A2.5 2.5 0 0 1 4 19.5V2",key:"1hjrqt"}],["path",{d:"M20 2v17.5a2.5 2.5 0 0 1-2.5 2.5a2.5 2.5 0 0 1-2.5-2.5V2",key:"16lc8n"}],["path",{d:"M3 2h7",key:"7s29d5"}],["path",{d:"M14 2h7",key:"7sicin"}],["path",{d:"M9 16H4",key:"1bfye3"}],["path",{d:"M20 16h-5",key:"ddnjpe"}]]),ce=({onComplete:f,onBack:v})=>{const[r,p]=o.useState(),[y,m]=o.useState([]),[l,j]=o.useState(null),[S,w]=o.useState(!1),[k,h]=o.useState("");o.useEffect(()=>{r&&O()},[r]);const O=async()=>{if(r){w(!0),h("");try{const c=r.getFullYear(),d=String(r.getMonth()+1).padStart(2,"0"),T=String(r.getDate()).padStart(2,"0"),{data:g,error:N}=await E.functions.invoke("get-diagnostics-slots",{body:{date:`${c}-${d}-${T}`}});if(N){console.error("Supabase function error:",N),h("Unable to fetch available slots. Please try again."),m([]);return}m(g?.slots||[]),(!g?.slots||g.slots.length===0)&&h("No available slots for this date. Please select another date.")}catch(c){console.error("Error fetching slots:",c),h("Unable to fetch available slots. Please try again."),m([])}finally{w(!1)}}},b=()=>{if(!l||!r)return;const c={start:l.start,end:l.end,date:r.toISOString().split("T")[0]};f(c)},C=c=>{const d=new Date;return d.setHours(0,0,0,0),c<d};return e.jsx("div",{className:"space-y-6",children:e.jsxs(D,{children:[e.jsxs(F,{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-blue-600"}),"Schedule Home Collection"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select your preferred date and time for blood sample collection at home"})]}),e.jsxs(P,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Date"}),e.jsx(re,{mode:"single",selected:r,onSelect:p,disabled:c=>C(c),className:"rounded-md border"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Our phlebotomist will visit your home at the selected time"})]}),r&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Available Time Slots for ",r.toLocaleDateString()]}),k&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg mb-4",children:e.jsx("p",{className:"text-red-700 text-sm",children:k})}),S?e.jsx("div",{className:"text-center py-4",children:"Loading available slots..."}):y.length>0?e.jsx("div",{className:"grid grid-cols-3 gap-2",children:y.map((c,d)=>e.jsx(x,{variant:l?.start===c.start?"default":"outline",size:"sm",onClick:()=>j(c),className:"text-sm",children:c.display},d))}):k?null:e.jsx("p",{className:"text-center py-4 text-gray-500",children:"No available slots for this date"})]}),l&&r&&e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("h4",{className:"font-medium text-green-800 mb-2 flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Collection Summary"]}),e.jsxs("div",{className:"space-y-1 text-sm text-green-700",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Service:"})," Home Blood Collection"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",r?.toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Time:"})," ",l.display]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Location:"})," Your Home Address"]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(x,{variant:"outline",onClick:v,className:"flex-1",children:"Back"}),e.jsx(x,{onClick:b,disabled:!l||!r,className:"flex-1",children:"Continue"})]})]})]})})},Ce=()=>{const[f,v]=o.useState([]),[r,p]=o.useState(!0),[y,m]=o.useState(null),[l,j]=o.useState({}),[S,w]=o.useState(""),[k,h]=o.useState(!1),[O,b]=o.useState(!1),[C,c]=o.useState(!1),[d,T]=o.useState(null),[g,N]=o.useState({name:"",phone:"",address:""}),{toast:u}=G();o.useEffect(()=>{const s=new URLSearchParams(window.location.search);s.get("code")=="off"&&c(!0);const t=s.get("q");t&&w(t)},[]);const B=async(s=!1)=>{try{p(!0),m(null);const a=s?`/lab-data.json?v=${new Date().getTime()}`:"/lab-data.json",t=await fetch(a);if(!t.ok){t.status===404?(v([]),m("Lab data has not been generated yet. Please click the refresh button to fetch it.")):(console.error("Error fetching tests:",await t.text()),m("Failed to load tests. Please try again."));return}const i=await t.text();if(!i){v([]),m("Lab data is empty. Please click the refresh button to fetch it.");return}const n=JSON.parse(i);v(n?.medicines||[])}catch(a){console.error("Error parsing lab data:",a),m("Failed to load tests. The data file might be corrupted or in an invalid format.")}finally{p(!1)}},M=async()=>{try{p(!0),m(null),u({title:"Refreshing...",description:"Fetching the latest test data."});const{error:s}=await E.functions.invoke("fetch-lab-data?refresh=true");if(s){console.error("Error refreshing tests:",s),m("Failed to refresh tests. Please try again."),u({title:"Refresh failed",description:"Could not fetch the latest data.",variant:"destructive"}),p(!1);return}await B(!0),u({title:"Refresh complete",description:"You are viewing the latest test data."})}catch(s){console.error("Error during refresh:",s),m("An unexpected error occurred during refresh."),u({title:"Refresh failed",description:"An unexpected error occurred.",variant:"destructive"}),p(!1)}};o.useEffect(()=>{B()},[]);const $=(()=>{const s=S.toLowerCase().split(",").map(i=>i.trim()).filter(i=>i);if(s.length===0)return f;const a=[],t=new Set;for(const i of s)for(const n of f)t.has(n.id)||(n.name.replace(/[.,;]/g,"").toLowerCase().includes(i)||n.category&&n.category.toLowerCase().includes(i)||n.description&&n.description.toLowerCase().includes(i))&&(a.push(n),t.add(n.id));return a})(),U=s=>{j(a=>({...a,[s]:(a[s]||0)+1})),u({title:"Added to cart",description:"Test added successfully!"})},V=s=>{j(a=>{const t={...a};return t[s]>1?t[s]-=1:delete t[s],t})},L=()=>Object.entries(l).reduce((s,[a,t])=>{const i=f.find(A=>A.id===a);if(!i)return s;const n=C?i.price:i.marketPrice;return s+n*t},0),q=()=>{const s=document.querySelector("[data-cart-section]");s&&s.scrollIntoView({behavior:"smooth",block:"center"})},I=()=>{if(Object.keys(l).length===0){u({title:"Cart is empty",description:"Please add tests to your cart first.",variant:"destructive"});return}h(!0)},W=s=>{T(s),h(!1),b(!0)},J=async()=>{try{const s=Object.entries(l).map(([t,i])=>{const n=f.find(A=>A.id===t);return{name:n?.name||"",quantity:i,price:n?.price||0}});if(d){const{error:t}=await E.functions.invoke("book-diagnostics",{body:{patientData:g,timeSlotData:d,items:s,total:L()}});t&&console.error("Error booking diagnostics:",t)}const{error:a}=await E.functions.invoke("send-order-email",{body:{orderType:"diagnostics",patientData:g,items:s,total:L()}});a?(console.error("Error sending email:",a),u({title:"Tests booked!",description:`Your tests have been booked successfully.${d?` Home collection scheduled for ${new Date(d.start).toLocaleDateString()} at ${new Date(d.start).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}.`:" We'll contact you soon."}`})):u({title:"Tests booked successfully!",description:`Our technician will visit you on ${d?new Date(d.start).toLocaleDateString()+" at "+new Date(d.start).toLocaleTimeString("en-US",{timeZone:"UTC",hour:"2-digit",minute:"2-digit",hour12:!0}):"the scheduled time"}.`}),j({}),b(!1),h(!1),T(null),N({name:"",phone:"",address:""})}catch(s){console.error("Error:",s),u({title:"Tests booked!",description:"Your tests have been booked successfully. We'll contact you soon."}),j({}),b(!1),h(!1),T(null),N({name:"",phone:"",address:""})}};return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(Q,{}),e.jsx("main",{className:"flex-grow",children:e.jsx("section",{className:"py-16 bg-gradient-to-b from-background to-muted/50",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsx("h1",{className:"text-4xl font-bold",children:"Home Diagnostics"}),e.jsx(x,{variant:"outline",size:"icon",onClick:M,disabled:r,title:"Refresh tests",children:e.jsx(K,{className:`h-4 w-4 ${r?"animate-spin":""}`})})]}),e.jsx("p",{className:"text-xl text-muted-foreground",children:"Convenient, accurate, and affordable lab testsâ€”right from the comfort of your home."})]}),y&&e.jsx("div",{className:"max-w-md mx-auto mb-8",children:e.jsx(D,{className:"border-destructive",children:e.jsx(P,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-destructive mb-4",children:y}),e.jsx(x,{onClick:M,disabled:r,children:r?"Loading...":"Try Again"})]})})})}),e.jsx("div",{className:"max-w-md mx-auto mb-8",children:e.jsx(ie,{type:"text",placeholder:"Search by test name (creatinine) or by complaint/organ (kidney)",value:S,onChange:s=>w(s.target.value),className:"w-full",disabled:r})}),r?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12",children:[...Array(6)].map((s,a)=>e.jsxs(D,{className:"animate-pulse",children:[e.jsxs(F,{children:[e.jsx("div",{className:"h-4 bg-muted rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-muted rounded w-full"})]}),e.jsxs(P,{children:[e.jsx("div",{className:"h-4 bg-muted rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-6 bg-muted rounded w-1/4"})]}),e.jsx(H,{children:e.jsx("div",{className:"h-10 bg-muted rounded w-full"})})]},a))}):$.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Y,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No tests found"}),e.jsx("p",{className:"text-muted-foreground",children:S?"Try searching with different keywords":"No tests available at the moment"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12",children:$.map(s=>e.jsxs(D,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(F,{children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(R,{className:"text-lg",children:s.name}),e.jsxs(oe,{variant:"destructive",className:"text-xs w-fit ml-auto",children:[Math.ceil((s.marketPrice-s.price)/s.marketPrice*100),"% OFF"]})]}),s.description&&e.jsx(ae,{children:s.description})]}),e.jsx(P,{children:e.jsxs("div",{className:"space-y-2 mb-4",children:[s.category&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Category:"}),e.jsx("span",{className:"text-sm",children:s.category})]}),s.duration&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(z,{className:"h-3 w-3"}),"Results:"]}),e.jsx("span",{className:"text-sm",children:s.duration})]}),e.jsx("div",{className:"text-right",children:s.marketPrice&&s.marketPrice>s.price&&C?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-sm text-muted-foreground line-through",children:["â‚¹",s.marketPrice]}),e.jsxs("span",{className:"text-lg font-semibold text-green-600",children:["â‚¹",s.price]})]}):e.jsxs("span",{className:"text-lg font-semibold",children:["â‚¹",s.marketPrice||s.price]})})]})}),e.jsx(H,{className:"flex justify-between items-center",children:l[s.id]?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{variant:"outline",size:"icon",onClick:()=>V(s.id),children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx("span",{className:"font-medium",children:l[s.id]}),e.jsx(x,{variant:"outline",size:"icon",onClick:()=>U(s.id),children:e.jsx(ee,{className:"h-4 w-4"})})]}):e.jsxs(x,{onClick:()=>U(s.id),className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"Add to Cart"]})})]},s.id))}),k?e.jsx("div",{className:"max-w-md mx-auto",children:e.jsx(ce,{onComplete:W,onBack:()=>h(!1)})}):O?e.jsx("div",{className:"max-w-md mx-auto",children:e.jsx(se,{patientData:g,onPatientDataChange:N,onSubmit:J,onBack:()=>{b(!1),h(!0)}})}):Object.keys(l).length>0&&e.jsxs(D,{className:"max-w-md mx-auto","data-cart-section":!0,children:[e.jsx(F,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),"Your Tests"]})}),e.jsxs(P,{children:[e.jsx("div",{className:"space-y-2 mb-4",children:Object.entries(l).map(([s,a])=>{const t=f.find(n=>n.id===s);if(!t)return null;const i=C?t.price:t.marketPrice;return e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[t.name," x",a]}),e.jsxs("span",{children:["â‚¹",i*a]})]},s)})}),e.jsxs("div",{className:"border-t pt-2 font-semibold",children:["Total: â‚¹",L()]})]}),e.jsx(H,{children:e.jsx(x,{onClick:I,className:"w-full",children:"Book Tests"})})]})]})})}),e.jsx(te,{itemCount:Object.values(l).reduce((s,a)=>s+a,0),total:L(),onViewCart:q,type:"diagnostics"}),e.jsx(X,{})]})};export{Ce as default};
