import{c as U,r as d,m as Z,j as e,B as p,R as _}from"./index-DYCdECr2.js";import{H as J,F as X}from"./Footer-5CF68671.js";import{P as V,a as ee,S as se,F as te}from"./FloatingCart-POT8qY6j.js";import{C as v,c as N,a as P,e as z,b as D,d as ae}from"./card-B7__9nPQ.js";import{I as re}from"./input-BlRor6HD.js";import{B as b}from"./badge-zPQ83eSx.js";import{S as ie,a as oe,b as ce,c as ne,d as le}from"./select-BmmlrwqD.js";import{s as L}from"./client-opfxi3BE.js";import{M as de}from"./minus-qXHcO3_K.js";import"./index-DOA-4b-m.js";import"./phone-DAWZ9XqU.js";import"./label-D6la_Z2I.js";import"./textarea-CrPgbkNX.js";import"./user-B71ZlHy8.js";import"./calendar-B3ZTj5yV.js";import"./index-DvPFuk_A.js";import"./Combination-DNRxZPOs.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=U("Pill",[["path",{d:"m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z",key:"wa1lgi"}],["path",{d:"m8.5 8.5 7 7",key:"rvfmvr"}]]),ze=()=>{const[u,R]=d.useState([]),[x,O]=d.useState(!0),[F,y]=d.useState(null),[n,f]=d.useState({}),[A,B]=d.useState({}),[S,$]=d.useState(""),[q,j]=d.useState(!1),[T,k]=d.useState({name:"",phone:"",address:""}),{toast:m}=Z(),g=async()=>{try{O(!0),y(null);const{data:s,error:t}=await L.functions.invoke("fetch-pharmacy-data");if(t){console.error("Error fetching medicines:",t),y("Failed to load medicines. Please try again.");return}R(s?.medicines||[])}catch(s){console.error("Error:",s),y("Failed to load medicines. Please try again.")}finally{O(!1)}};d.useEffect(()=>{const t=new URLSearchParams(window.location.search).get("q");t&&$(t),g()},[]);const E=(()=>{const s=S.toLowerCase().split(",").map(i=>i.trim()).filter(i=>i);if(s.length===0)return u;const t=[],r=new Set;for(const i of s)for(const a of u)r.has(a.id)||(a.name.toLowerCase().includes(i)||a.category.toLowerCase().includes(i)||a.description.toLowerCase().includes(i))&&(t.push(a),r.add(a.id));return t})(),G=(s,t)=>s.isGrouped&&t?`${s.id}-${t}`:s.id,w=(s,t)=>s.isGrouped&&t&&s.sizes?s.sizes.find(i=>i.size===t)?.stockCount||0:s.stockCount||0,I=(s,t)=>{const r=u.find(c=>c.id===s);if(!r)return;if(r.isGrouped&&!t){m({title:"Please select a size",description:"Please choose a size before adding to cart.",variant:"destructive"});return}const i=G(r,t),a=n[i]||0,o=w(r,t);if(a>=o){m({title:"Stock limit reached",description:`Only ${o} units available in stock.`,variant:"destructive"});return}f(c=>({...c,[i]:a+1})),m({title:"Added to cart",description:"Medicine added successfully!"})},K=s=>{f(t=>{const r={...t};return r[s]>1?r[s]-=1:delete r[s],r})},C=()=>Object.entries(n).reduce((s,[t,r])=>{const a=t.split("-")[0],o=u.find(c=>c.id===a);return s+(o?o.price*r:0)},0),Y=()=>{const s=document.querySelector("[data-cart-section]");s&&s.scrollIntoView({behavior:"smooth",block:"center"})},H=()=>{if(Object.keys(n).length===0){m({title:"Cart is empty",description:"Please add medicines to your cart first.",variant:"destructive"});return}const s=[];for(const[t,r]of Object.entries(n)){const i=t.split("-"),a=i[0],o=i.length>1?i.slice(1).join("-"):void 0,c=u.find(l=>l.id===a);if(c){const l=w(c,o);if(r>l){const h=c.isGrouped&&o?`${c.name} (${o})`:c.name;s.push(`${h}: Only ${l} available, but ${r} in cart`)}}}if(s.length>0){m({title:"Stock availability issue",description:s.join(". "),variant:"destructive"});return}j(!0)},W=async()=>{try{const s=Object.entries(n).map(([r,i])=>{console.log("Processing cart key for email:",r);const a=r.split("-"),o=a[0],c=a.length>1?a.slice(1).join("-"):void 0;console.log("Email - Medicine ID:",o,"Size:",c);const l=u.find(Q=>Q.id===o);console.log("Email - Found medicine:",l?.name);let h;return l?.isGrouped&&c?h=`${l.name} (Size: ${c})`:h=l?.name||"",console.log("Email - Display name:",h),{name:h,quantity:i,price:l?.price||0}}),{error:t}=await L.functions.invoke("send-order-email",{body:{orderType:"pharmacy",patientData:T,items:s,total:C()}});t?(console.error("Error sending email:",t),m({title:"Order placed!",description:"Your order has been placed successfully. We'll contact you soon."})):(m({title:"Order placed successfully!",description:"Your medicines will be delivered within 2-3 hours."}),g()),f({}),j(!1),k({name:"",phone:"",address:""})}catch(s){console.error("Error:",s),m({title:"Order placed!",description:"Your order has been placed successfully. We'll contact you soon."}),f({}),j(!1),k({name:"",phone:"",address:""})}};return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(J,{}),e.jsx("main",{className:"flex-grow",children:e.jsx("section",{className:"py-16 bg-gradient-to-b from-background to-muted/50",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsx("h1",{className:"text-4xl font-bold",children:"Online Pharmacy"}),e.jsx(p,{variant:"outline",size:"icon",onClick:g,disabled:x,title:"Refresh medicines",children:e.jsx(_,{className:`h-4 w-4 ${x?"animate-spin":""}`})})]}),e.jsx("p",{className:"text-xl text-muted-foreground",children:"Get great discounts on medicines delivered to your home"})]}),F&&e.jsx("div",{className:"max-w-md mx-auto mb-8",children:e.jsx(v,{className:"border-destructive",children:e.jsx(N,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-destructive mb-4",children:F}),e.jsx(p,{onClick:g,disabled:x,children:x?"Loading...":"Try Again"})]})})})}),e.jsx("div",{className:"max-w-md mx-auto mb-8",children:e.jsx(re,{type:"text",placeholder:"Search medicines or symptoms/complaints...",value:S,onChange:s=>$(s.target.value),className:"w-full",disabled:x})}),x?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12",children:[...Array(6)].map((s,t)=>e.jsxs(v,{className:"animate-pulse",children:[e.jsxs(P,{children:[e.jsx("div",{className:"h-4 bg-muted rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-muted rounded w-full"})]}),e.jsxs(N,{children:[e.jsx("div",{className:"h-4 bg-muted rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-6 bg-muted rounded w-1/4"})]}),e.jsx(z,{children:e.jsx("div",{className:"h-10 bg-muted rounded w-full"})})]},t))}):E.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(M,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No medicines found"}),e.jsx("p",{className:"text-muted-foreground",children:S?"Try searching with different keywords":"No medicines available at the moment"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12",children:E.map(s=>{const t=A[s.id],r=G(s,t),i=w(s,t);return e.jsxs(v,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(P,{children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground font-medium mt-1",children:s.category}),e.jsx(D,{className:"text-lg",children:s.name}),s.isGrouped&&s.sizes?e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs(b,{variant:"outline",className:"w-fit",children:["Available sizes: ",s.sizes.map(a=>a.size).join(", ")]}),e.jsxs(ie,{value:t||"",onValueChange:a=>B(o=>({...o,[s.id]:a})),children:[e.jsx(oe,{className:"w-full",children:e.jsx(ce,{placeholder:"Select size"})}),e.jsx(ne,{children:s.sizes.map(a=>e.jsxs(le,{value:a.size,disabled:!a.inStock||a.stockCount===0,children:[a.size," ",!a.inStock||a.stockCount===0?"(Out of Stock)":`(${a.stockCount} available)`]},a.size))})]})]}):e.jsx(b,{variant:s.inStock?"default":"secondary",className:"w-fit mt-2",children:s.inStock?"In Stock":"Out of Stock"})]})}),e.jsx(ae,{className:"mt-2",children:s.description}),(s.manufacturer||s.dosage||s.packSize)&&e.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground mt-2",children:[s.manufacturer&&e.jsxs("div",{children:["Brand: ",s.manufacturer]}),s.dosage&&e.jsxs("div",{children:["Dosage: ",s.dosage]}),s.packSize&&e.jsxs("div",{children:["Pack Size: ",s.packSize]})]})]}),e.jsx(N,{children:e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex flex-col",children:[!s.isGrouped&&s.stockCount!==void 0&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Stock: ",s.stockCount," available"]}),n[s.id]&&e.jsxs("span",{className:"text-xs text-orange-600",children:[" ",s.stockCount-n[s.id]," remaining"]})]}),s.isGrouped&&t&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Stock: ",i," available"]}),n[r]&&e.jsxs("span",{className:"text-xs text-orange-600",children:[" ",i-n[r]," remaining"]})]}),s.prescriptionRequired&&e.jsx(b,{variant:"outline",className:"w-fit mt-1",children:"Prescription Required"})]}),e.jsx("div",{className:"text-right",children:s.originalPrice&&s.originalPrice>s.price?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-sm text-muted-foreground line-through",children:["₹",s.originalPrice]}),e.jsxs("span",{className:"text-lg font-semibold text-green-600",children:["₹",s.price]}),s.discount&&s.discount>0&&e.jsxs(b,{variant:"destructive",className:"text-xs w-fit ml-auto",children:[s.discount,"% OFF"]})]}):e.jsxs("span",{className:"text-lg font-semibold",children:["₹",s.price]})})]})}),e.jsx(z,{className:"flex justify-between items-center",children:n[r]?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(p,{variant:"outline",size:"icon",onClick:()=>K(r),children:e.jsx(de,{className:"h-4 w-4"})}),e.jsx("span",{className:"font-medium",children:n[r]}),e.jsx(p,{variant:"outline",size:"icon",onClick:()=>I(s.id,t),disabled:!s.inStock||(n[r]||0)>=i,children:e.jsx(V,{className:"h-4 w-4"})})]}):e.jsxs(p,{onClick:()=>I(s.id,t),disabled:!s.inStock||i===0||s.isGrouped&&!t,className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),i===0?"Out of Stock":s.isGrouped&&!t?"Select Size First":"Add to Cart"]})})]},s.id)})}),q?e.jsx("div",{className:"max-w-md mx-auto",children:e.jsx(ee,{patientData:T,onPatientDataChange:k,onSubmit:W,onBack:()=>j(!1)})}):Object.keys(n).length>0&&e.jsxs(v,{className:"max-w-md mx-auto","data-cart-section":!0,children:[e.jsx(P,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5"}),"Your Cart"]})}),e.jsxs(N,{children:[e.jsx("div",{className:"space-y-2 mb-4",children:Object.entries(n).map(([s,t])=>{const r=s.split("-"),i=r[0],a=r.length>1?r.slice(1).join("-"):void 0,o=u.find(l=>l.id===i);if(!o)return null;let c;return o.isGrouped&&a?c=`${o.name} (${a})`:c=o.name,e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[c," x",t]}),e.jsxs("span",{children:["₹",o.price*t]})]},s)})}),e.jsxs("div",{className:"border-t pt-2 font-semibold",children:["Total: ₹",C()]})]}),e.jsx(z,{children:e.jsx(p,{onClick:H,className:"w-full",children:"Continue to Confirm Order"})})]})]})})}),e.jsx(te,{itemCount:Object.values(n).reduce((s,t)=>s+t,0),total:C(),onViewCart:Y,type:"pharmacy"}),e.jsx(X,{})]})};export{ze as default};
