import{c as ge,r as s,j as e,f as I,e as fe,g as ue,z as xe,a as p,s as $,x as he,y as ye,m as ve,B as De}from"./index-DYCdECr2.js";import{H as R,F as O}from"./Footer-5CF68671.js";import{B as Ae}from"./BlogPostForm-DyVOBuRl.js";import{s as u}from"./client-opfxi3BE.js";import{S as j}from"./skeleton-DeYKIxXw.js";import{c as M,R as Ne,T as je,P as we,W as be,C as _e,a as Ee,D as Pe,b as k,O as Te}from"./index-B0uWZoEh.js";import"./index-DOA-4b-m.js";import"./phone-DAWZ9XqU.js";import"./RichTextEditor-SEif6zb0.js";import"./label-D6la_Z2I.js";import"./quote-CL5U8GGT.js";import"./link-JZZbcmPv.js";import"./minus-qXHcO3_K.js";import"./input-BlRor6HD.js";import"./textarea-CrPgbkNX.js";import"./tabs-C7V-UyVv.js";import"./Combination-DNRxZPOs.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=ge("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var F="AlertDialog",[Ce,ct]=fe(F,[M]),c=M(),q=t=>{const{__scopeAlertDialog:a,...o}=t,r=c(a);return e.jsx(Ne,{...r,...o,modal:!0})};q.displayName=F;var Re="AlertDialogTrigger",H=s.forwardRef((t,a)=>{const{__scopeAlertDialog:o,...r}=t,i=c(o);return e.jsx(je,{...i,...r,ref:a})});H.displayName=Re;var Oe="AlertDialogPortal",L=t=>{const{__scopeAlertDialog:a,...o}=t,r=c(a);return e.jsx(we,{...r,...o})};L.displayName=Oe;var Ie="AlertDialogOverlay",z=s.forwardRef((t,a)=>{const{__scopeAlertDialog:o,...r}=t,i=c(o);return e.jsx(Te,{...i,...r,ref:a})});z.displayName=Ie;var y="AlertDialogContent",[$e,Me]=Ce(y),ke=xe("AlertDialogContent"),B=s.forwardRef((t,a)=>{const{__scopeAlertDialog:o,children:r,...i}=t,v=c(o),x=s.useRef(null),w=I(a,x),D=s.useRef(null);return e.jsx(be,{contentName:y,titleName:G,docsSlug:"alert-dialog",children:e.jsx($e,{scope:o,cancelRef:D,children:e.jsxs(_e,{role:"alertdialog",...v,...i,ref:w,onOpenAutoFocus:ue(i.onOpenAutoFocus,m=>{m.preventDefault(),D.current?.focus({preventScroll:!0})}),onPointerDownOutside:m=>m.preventDefault(),onInteractOutside:m=>m.preventDefault(),children:[e.jsx(ke,{children:r}),e.jsx(qe,{contentRef:x})]})})})});B.displayName=y;var G="AlertDialogTitle",V=s.forwardRef((t,a)=>{const{__scopeAlertDialog:o,...r}=t,i=c(o);return e.jsx(Ee,{...i,...r,ref:a})});V.displayName=G;var U="AlertDialogDescription",W=s.forwardRef((t,a)=>{const{__scopeAlertDialog:o,...r}=t,i=c(o);return e.jsx(Pe,{...i,...r,ref:a})});W.displayName=U;var Fe="AlertDialogAction",Y=s.forwardRef((t,a)=>{const{__scopeAlertDialog:o,...r}=t,i=c(o);return e.jsx(k,{...i,...r,ref:a})});Y.displayName=Fe;var J="AlertDialogCancel",K=s.forwardRef((t,a)=>{const{__scopeAlertDialog:o,...r}=t,{cancelRef:i}=Me(J,o),v=c(o),x=I(a,i);return e.jsx(k,{...v,...r,ref:x})});K.displayName=J;var qe=({contentRef:t})=>{const a=`\`${y}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${y}\` by passing a \`${U}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${y}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return s.useEffect(()=>{document.getElementById(t.current?.getAttribute("aria-describedby"))||console.warn(a)},[a,t]),null},He=q,Le=H,ze=L,Q=z,X=B,Z=Y,ee=K,te=V,ae=W;const Be=He,Ge=Le,Ve=ze,oe=s.forwardRef(({className:t,...a},o)=>e.jsx(Q,{className:p("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...a,ref:o}));oe.displayName=Q.displayName;const se=s.forwardRef(({className:t,...a},o)=>e.jsxs(Ve,{children:[e.jsx(oe,{}),e.jsx(X,{ref:o,className:p("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...a})]}));se.displayName=X.displayName;const re=({className:t,...a})=>e.jsx("div",{className:p("flex flex-col space-y-2 text-center sm:text-left",t),...a});re.displayName="AlertDialogHeader";const ie=({className:t,...a})=>e.jsx("div",{className:p("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a});ie.displayName="AlertDialogFooter";const le=s.forwardRef(({className:t,...a},o)=>e.jsx(te,{ref:o,className:p("text-lg font-semibold",t),...a}));le.displayName=te.displayName;const ne=s.forwardRef(({className:t,...a},o)=>e.jsx(ae,{ref:o,className:p("text-sm text-muted-foreground",t),...a}));ne.displayName=ae.displayName;const ce=s.forwardRef(({className:t,...a},o)=>e.jsx(Z,{ref:o,className:p($(),t),...a}));ce.displayName=Z.displayName;const de=s.forwardRef(({className:t,...a},o)=>e.jsx(ee,{ref:o,className:p($({variant:"outline"}),"mt-2 sm:mt-0",t),...a}));de.displayName=ee.displayName;const dt=()=>{const{postId:t}=he(),a=ye(),{toast:o}=ve(),[r,i]=s.useState(null),[v,x]=s.useState({}),[w,D]=s.useState(!0),[m,P]=s.useState(!1),[T,S]=s.useState(!1);s.useEffect(()=>{(async()=>{if(t){D(!0);try{const{data:l,error:f}=await u.from("posts").select("*, categories(name)").eq("id",t).single();if(f)throw f;if(l){const{categories:b,..._}=l;i({..._,category_name:b?.name||""});const{data:A,error:h}=await u.from("post_translations").select("*").eq("post_id",t);if(h)throw h;const N={};for(const d of A)N[d.language]={title:d.title,excerpt:d.excerpt,content:d.content,next_steps:d.next_steps};x(N)}else o({title:"Error",description:"Post not found.",variant:"destructive"}),a("/blog")}catch(l){console.error("Error fetching post data:",l),o({title:"Error",description:"Could not fetch post data.",variant:"destructive"})}finally{D(!1)}}})()},[t,a,o]);const pe=async(g,l)=>{P(!0);try{const{category_name:f,...b}=g,{data:_,error:A}=await u.from("categories").select("id").eq("name",f).single();if(A&&A.code!=="PGRST116")throw A;let h=_?.id;if(!h){const{data:n,error:C}=await u.from("categories").insert({name:f}).select("id").single();if(C)throw C;h=n.id}const N={...b,category_id:h},{error:d}=await u.from("posts").update(N).eq("id",t);if(d)throw d;const E=[];for(const n in l)(l[n].title||l[n].excerpt||l[n].content||l[n].next_steps)&&E.push({post_id:t,language:n,title:l[n].title,excerpt:l[n].excerpt,content:l[n].content,next_steps:l[n].next_steps});if(E.length>0){const{error:n}=await u.from("post_translations").upsert(E,{onConflict:"post_id,language"});if(n)throw n}o({title:"Post and translations updated!",description:"Your blog post has been successfully updated."}),a(`/blog/${t}`)}catch(f){console.error("Error updating post:",f),o({title:"Error",description:"There was an error updating the post. Please try again.",variant:"destructive"})}finally{P(!1)}},me=async()=>{if(t){S(!0);try{const{error:g}=await u.from("posts").delete().eq("id",t);if(g)throw g;o({title:"Post deleted!",description:"The blog post has been successfully deleted."}),a("/blog")}catch(g){console.error("Error deleting post:",g),o({title:"Error",description:"There was an error deleting the post. Please try again.",variant:"destructive"})}finally{S(!1)}}};return w?e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(R,{}),e.jsx("main",{className:"flex-grow bg-muted/50 pt-20",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx(j,{className:"h-8 w-1/2 mb-8"}),e.jsxs("div",{className:"space-y-8",children:[e.jsx(j,{className:"h-10 w-full"}),e.jsx(j,{className:"h-20 w-full"}),e.jsx(j,{className:"h-40 w-full"})]})]})})}),e.jsx(O,{})]}):e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(R,{}),e.jsx("main",{className:"flex-grow bg-muted/50 pt-20",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-heading font-bold text-primary",children:"Edit Post"}),e.jsxs(Be,{children:[e.jsx(Ge,{asChild:!0,children:e.jsxs(De,{variant:"destructive",children:[e.jsx(Se,{className:"mr-2 h-4 w-4"}),"Delete Post"]})}),e.jsxs(se,{children:[e.jsxs(re,{children:[e.jsx(le,{children:"Are you absolutely sure?"}),e.jsx(ne,{children:"This action cannot be undone. This will permanently delete this blog post and remove its data from our servers."})]}),e.jsxs(ie,{children:[e.jsx(de,{children:"Cancel"}),e.jsx(ce,{onClick:me,disabled:T,children:T?"Deleting...":"Continue"})]})]})]})]}),r?e.jsx(Ae,{initialData:r,translations:v,onSubmit:pe,isSubmitting:m}):e.jsx("p",{children:"Post data could not be loaded."})]})})}),e.jsx(O,{})]})};export{dt as default};
