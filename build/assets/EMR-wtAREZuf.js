import{r as c,t as f,j as e,a as N,B as b,L as q}from"./index-DYCdECr2.js";import{I as h}from"./input-BlRor6HD.js";import{L as o}from"./label-D6la_Z2I.js";import{T as j}from"./textarea-CrPgbkNX.js";import{C as B,a as de,b as me,d as he,c as xe}from"./card-B7__9nPQ.js";import{S as y,a as D,b as w,c as C,d as x}from"./select-BmmlrwqD.js";import{f as J,C as pe}from"./calendar-CWHqpNrr.js";import{P as ge,a as ue,b as fe}from"./popover-DCuamr63.js";import{s as I}from"./client-opfxi3BE.js";import{S as $}from"./stethoscope-COz3Oi6Z.js";import{U as z}from"./user-B71ZlHy8.js";import{C as je}from"./calendar-B3ZTj5yV.js";import{P as ve}from"./phone-DAWZ9XqU.js";import{F as Ne}from"./file-text-CbUmlQ7m.js";import"./index-DvPFuk_A.js";import"./index-DOA-4b-m.js";import"./Combination-DNRxZPOs.js";let G;const Te=()=>{const[i,v]=c.useState({name:"",dob:void 0,sex:"M",phone:""}),[F,S]=c.useState([]),[H,k]=c.useState(""),[P,U]=c.useState(""),[_,K]=c.useState(!1),[R,A]=c.useState(!1),[l,p]=c.useState({complaints:"",findings:"",investigations:"",diagnosis:"",advice:"",medications:[{name:"T. HIFENAC SP",dose:"1 tab",freqMorning:!0,freqNoon:!1,freqNight:!0,duration:"1 week",instructions:"Aft. meal"},{name:"T. PANTOVAR",dose:"40 mg",freqMorning:!0,freqNoon:!1,freqNight:!1,duration:"1 week",instructions:"Bef. breakfast"}]}),[d,E]=c.useState({}),[O,T]=c.useState(!1),[g,M]=c.useState(new Date(2e3,0,1)),[Q,L]=c.useState(!1),W=()=>{const s={};return i.name.trim()||(s.name="Name is required"),i.dob||(s.dob="Date of birth is required"),i.dob&&i.dob>new Date&&(s.dob="Date of birth cannot be in the future"),i.phone&&!/^\d{10}$/.test(i.phone.replace(/\D/g,""))&&(s.phone="Enter valid 10-digit phone number"),E(s),Object.keys(s).length===0},V=(s,a)=>{v(t=>({...t,[s]:a})),d[s]&&E(t=>({...t,[s]:void 0})),s==="phone"&&(S([]),k(""))},X=async s=>{K(!0);try{const{data:a,error:t}=await I.functions.invoke("search-patient-records",{body:{phoneNumber:s}});if(t)throw t;a?.patientFolders?.length>0?(S(a.patientFolders),f({title:"Patient Records Found",description:`Found ${a.patientFolders.length} patient record(s). Please select a patient.`})):(S([]),k(""))}catch(a){console.error("Error searching patient records:",a),f({variant:"destructive",title:"Search Error",description:"Failed to search patient records. Please try again."})}finally{K(!1)}},Z=s=>{const a=F.find(t=>t.id===s);k(a?.name||s),U(s)};c.useEffect(()=>{P&&ee(P)},[P]);const ee=async s=>{A(!0);try{const{data:a,error:t}=await I.functions.invoke("search-patient-records",{body:{phoneNumber:i.phone,selectedFolder:s}});if(t)throw t;if(a?.patientData){const n=a.patientData;window.folderId=a.folderId,G=n.id,v(r=>({...r,name:n.name||r.name,dob:n.dob?new Date(n.dob):r.dob,sex:n.sex||r.sex})),p(r=>({...r,complaints:n.complaints||r.complaints,findings:n.findings||r.findings,investigations:n.investigations||r.investigations,diagnosis:n.diagnosis||r.diagnosis,advice:n.advice||r.advice,medications:n.medications?.length?n.medications:r.medications})),f({title:"Data Loaded",description:"Patient data has been auto-filled."})}}catch(a){console.error("Error loading patient data:",a),f({variant:"destructive",title:"Load Error",description:"Failed to load patient data."})}finally{A(!1)}},se=s=>v(a=>({...a,sex:s})),ae=s=>{v(a=>({...a,dob:s})),d.dob&&E(a=>({...a,dob:void 0})),s&&L(!1)},te=s=>{const a=new Date(g);a.setFullYear(parseInt(s)),M(a)},ne=s=>{const a=new Date(g);a.setMonth(parseInt(s)),M(a)},u=(s,a)=>{p(t=>({...t,[s]:a}))},m=(s,a,t)=>{p(n=>{const r=[...n.medications];return r[s][a]=t,{...n,medications:r}})},ie=()=>{p(s=>({...s,medications:[...s.medications,{name:"",dose:"",freqMorning:!1,freqNoon:!1,freqNight:!1,duration:"",instructions:""}]}))},re=s=>{p(a=>({...a,medications:a.medications.filter((t,n)=>n!==s)}))},oe=async s=>{if(s.preventDefault(),!!W()){T(!0);try{const a={folderId:window.folderId,patientId:G,name:i.name,dob:i.dob?J(i.dob,"yyyy-MM-dd"):"",sex:i.sex,phone:i.phone,complaints:l.complaints,findings:l.findings,investigations:l.investigations,diagnosis:l.diagnosis,advice:l.advice,medications:JSON.stringify(l.medications)},{data:t,error:n}=await I.functions.invoke("create-docs-prescription",{body:a});if(n)throw new Error(n.message||"Failed to create prescription");if(t?.error)throw new Error(t.error);t?.url&&(window.location.href=t.url)}catch(a){console.error("Error:",a),f({variant:"destructive",title:"Error",description:"Registration failed. Please try again."})}finally{T(!1)}}},Y=new Date().getFullYear(),le=Array.from({length:Y-1929},(s,a)=>Y-a),ce=["January","February","March","April","May","June","July","August","September","October","November","December"];return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 via-background to-secondary/5 p-4",children:e.jsx("div",{className:"container mx-auto max-w-4xl",children:e.jsxs(B,{className:"shadow-lg border-0 bg-card/95 backdrop-blur supports-[backdrop-filter]:bg-card/60",children:[e.jsxs(de,{className:"text-center pb-8",children:[e.jsxs(me,{className:"flex items-center justify-center gap-3 text-2xl font-bold text-primary",children:[e.jsx($,{className:"w-7 h-7"}),"Electronic Medical Records"]}),e.jsx(he,{className:"text-lg text-muted-foreground",children:"Patient Registration & Prescription Management System"})]}),e.jsx(xe,{className:"space-y-8",children:e.jsxs("form",{onSubmit:oe,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(z,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Patient Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"name",className:"text-sm font-medium",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"w-4 h-4 absolute left-3 top-3 text-muted-foreground"}),e.jsx(h,{id:"name",value:i.name,onChange:s=>V("name",s.target.value),onKeyDown:s=>s.key==="Enter"&&s.preventDefault(),className:N("pl-10",d.name&&"border-destructive"),placeholder:"Enter full name"})]}),d.name&&e.jsx("p",{className:"text-sm text-destructive",children:d.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"dob",className:"text-sm font-medium",children:"Date of Birth"}),e.jsxs(ge,{open:Q,onOpenChange:L,children:[e.jsx(ue,{asChild:!0,children:e.jsxs(b,{variant:"outline",className:N("w-full justify-start text-left font-normal",!i.dob&&"text-muted-foreground",d.dob&&"border-destructive"),children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),i.dob?J(i.dob,"PPP"):e.jsx("span",{children:"Select date of birth"})]})}),e.jsxs(fe,{className:"w-auto p-0",align:"start",children:[e.jsx("div",{className:"p-3 border-b space-y-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{value:g.getMonth().toString(),onValueChange:ne,children:[e.jsx(D,{className:"flex-1",children:e.jsx(w,{})}),e.jsx(C,{children:ce.map((s,a)=>e.jsx(x,{value:a.toString(),children:s},a))})]}),e.jsxs(y,{value:g.getFullYear().toString(),onValueChange:te,children:[e.jsx(D,{className:"flex-1",children:e.jsx(w,{})}),e.jsx(C,{className:"max-h-48",children:le.map(s=>e.jsx(x,{value:s.toString(),children:s},s))})]})]})}),e.jsx(pe,{mode:"single",selected:i.dob,onSelect:ae,month:g,onMonthChange:M,disabled:s=>s>new Date||s<new Date("1900-01-01"),initialFocus:!0,className:N("p-3 pointer-events-auto")})]})]}),d.dob&&e.jsx("p",{className:"text-sm text-destructive",children:d.dob})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"sex",className:"text-sm font-medium",children:"Sex"}),e.jsxs(y,{value:i.sex,onValueChange:se,children:[e.jsx(D,{children:e.jsx(w,{})}),e.jsxs(C,{children:[e.jsx(x,{value:"M",children:"Male"}),e.jsx(x,{value:"F",children:"Female"}),e.jsx(x,{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"phone",className:"text-sm font-medium",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"w-4 h-4 absolute left-3 top-3 text-muted-foreground"}),e.jsx(h,{id:"phone",value:i.phone,onChange:s=>V("phone",s.target.value),onKeyDown:s=>s.key==="Enter"&&(s.preventDefault(),X(s.target.value)),className:N("pl-10",d.phone&&"border-destructive"),placeholder:"1234567890"}),_&&e.jsx(q,{className:"w-4 h-4 absolute right-3 top-3 animate-spin text-muted-foreground"})]}),d.phone&&e.jsx("p",{className:"text-sm text-destructive",children:d.phone})]})]}),F.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Select Patient Record"}),e.jsxs(y,{value:H,onValueChange:Z,disabled:R,children:[e.jsxs(D,{className:"relative",children:[e.jsx(w,{placeholder:"Choose existing patient record..."}),R&&e.jsx(q,{className:"w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 animate-spin text-muted-foreground"})]}),e.jsx(C,{children:F.map(s=>e.jsx(x,{value:s.id,children:s.name},s.id))})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ne,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Medical Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"complaints",className:"text-sm font-medium",children:"Complaints"}),e.jsx(j,{id:"complaints",value:l.complaints,onChange:s=>u("complaints",s.target.value),placeholder:"Patient complaints...",onKeyDown:s=>s.key==="Enter"&&s.stopPropagation(),className:"min-h-[100px]"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"findings",className:"text-sm font-medium",children:"Clinical Findings"}),e.jsx(j,{id:"findings",value:l.findings,onChange:s=>u("findings",s.target.value),placeholder:"Clinical findings...",onKeyDown:s=>s.key==="Enter"&&s.stopPropagation(),className:"min-h-[100px]"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"investigations",className:"text-sm font-medium",children:"Investigations"}),e.jsx(j,{id:"investigations",value:l.investigations,onChange:s=>u("investigations",s.target.value),placeholder:"Investigations required...",onKeyDown:s=>s.key==="Enter"&&s.stopPropagation(),className:"min-h-[100px]"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"diagnosis",className:"text-sm font-medium",children:"Diagnosis"}),e.jsx(j,{id:"diagnosis",value:l.diagnosis,onChange:s=>u("diagnosis",s.target.value),placeholder:"Clinical diagnosis...",onKeyDown:s=>s.key==="Enter"&&s.stopPropagation(),className:"min-h-[100px]"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"advice",className:"text-sm font-medium",children:"Medical Advice"}),e.jsx(j,{id:"advice",value:l.advice,onChange:s=>u("advice",s.target.value),placeholder:"Medical advice and recommendations...",onKeyDown:s=>s.key==="Enter"&&s.stopPropagation(),className:"min-h-[80px]"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Medications"})]})}),e.jsx("div",{className:"space-y-4",children:l.medications.map((s,a)=>e.jsx(B,{className:"p-4 border border-border",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Medicine Name"}),e.jsx(h,{value:s.name,onChange:t=>m(a,"name",t.target.value),placeholder:"Enter medicine name",onKeyDown:t=>t.key==="Enter"&&t.preventDefault()})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Dosage"}),e.jsx(h,{value:s.dose,onChange:t=>m(a,"dose",t.target.value),placeholder:"e.g., 500mg",onKeyDown:t=>t.key==="Enter"&&t.preventDefault()})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Frequency"}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.freqMorning,onChange:t=>m(a,"freqMorning",t.target.checked),onKeyDown:t=>t.key==="Enter"&&(t.preventDefault(),m(a,"freqMorning",!s.freqMorning)),className:"rounded border-border"}),e.jsx("span",{className:"text-sm",children:"Morning"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.freqNoon,onChange:t=>m(a,"freqNoon",t.target.checked),onKeyDown:t=>t.key==="Enter"&&(t.preventDefault(),m(a,"freqNoon",!s.freqNoon)),className:"rounded border-border"}),e.jsx("span",{className:"text-sm",children:"Noon"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.freqNight,onChange:t=>m(a,"freqNight",t.target.checked),onKeyDown:t=>t.key==="Enter"&&(t.preventDefault(),m(a,"freqNight",!s.freqNight)),className:"rounded border-border"}),e.jsx("span",{className:"text-sm",children:"Night"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Duration"}),e.jsx(h,{value:s.duration,onChange:t=>m(a,"duration",t.target.value),placeholder:"e.g., 7 days",onKeyDown:t=>t.key==="Enter"&&t.preventDefault()})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Instructions"}),e.jsx(h,{value:s.instructions,onChange:t=>m(a,"instructions",t.target.value),placeholder:"Special instructions",onKeyDown:t=>t.key==="Enter"&&t.preventDefault()})]})]}),l.medications.length>0&&e.jsx("div",{className:"flex justify-end",children:e.jsx(b,{type:"button",variant:"destructive",size:"sm",onClick:()=>re(a),children:"Remove Medication"})})]})},a))}),e.jsx("div",{className:"flex justify-end",children:e.jsx(b,{type:"button",onClick:ie,variant:"outline",size:"sm",children:"Add Medication"})})]}),e.jsx("div",{className:"pt-6",children:e.jsx(b,{type:"submit",className:"w-full h-12 text-lg font-semibold",disabled:O,children:O?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"mr-2 h-5 w-5 animate-spin"}),"Generating Prescription..."]}):"Generate Prescription"})})]})})]})})})};export{Te as default};
